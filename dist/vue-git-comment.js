!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.VueGitComment=e():t.VueGitComment=e()}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var s=e[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s="Pb8N")}({Fa5i:function(t,e){},IMhz:function(t,e){},LNnq:function(t,e){},Pb8N:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o={client_id:"",client_secret:"",access_token:"",owner:"",repo:"",key:"",loading:!0,ifLogin:!1,userInfo:{loading:!1,name:"",avatar_url:""},issue:{created:!0,number:0,likedCount:0},comments:{loading:!1,count:0,page:1,per_page:20,sortedAsc:!1,list:[]},update:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},reset:function(){Object.assign(o,JSON.parse(JSON.stringify(s)))}},s=JSON.parse(JSON.stringify(o)),r=o,i='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><path d="M25 39.7l-.6-.5C11.5 28.7 8 25 8 19c0-5 4-9 9-9 4.1 0 6.4 2.3 8 4.1 1.6-1.8 3.9-4.1 8-4.1 5 0 9 4 9 9 0 6-3.5 9.7-16.4 20.2l-.6.5zM17 12c-3.9 0-7 3.1-7 7 0 5.1 3.2 8.5 15 18.1 11.8-9.6 15-13 15-18.1 0-3.9-3.1-7-7-7-3.5 0-5.4 2.1-6.9 3.8L25 17.1l-1.1-1.3C22.4 14.1 20.5 12 17 12z"/></svg>',a={data:function(){return{heartIcon:i,store:r,liked:!0}},methods:{toggleLike:function(){this.liked=!this.liked},changeSort:function(t){this.store.comments.sortedAsc=t}}},c={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"comment-header"},[n("span",{staticClass:"like-item",on:{click:t.toggleLike}},[n("span",{staticClass:"heart-icon",class:{liked:t.liked},domProps:{innerHTML:t._s(t.heartIcon)}}),t._v(" "),n("span",{staticClass:"heart-txt"},[n("strong",[t._v(t._s(t.store.issue.likedCount))]),t._v(" Liked\n        ")])]),t._v(" "),n("span",{staticClass:"comment-num"},[t._v("\n        •\n        "),n("strong",[t._v(t._s(t.store.comments.count))]),t._v(" Comments\n    ")]),t._v(" "),n("a",{staticClass:"issue-link",attrs:{href:"javascript:void(0)"}},[t._v("Issue Page")]),t._v(" "),n("strong",{staticClass:"sort-item",class:{active:t.store.comments.sortedAsc},attrs:{title:"sort by old"},on:{click:function(e){t.changeSort(!0)}}},[t._v("Old")]),t._v(" "),n("strong",{staticClass:"sort-item",staticStyle:{cursor:"default"}},[t._v("•")]),t._v(" "),n("strong",{staticClass:"sort-item",class:{active:!t.store.comments.sortedAsc},attrs:{title:"sort by new"},on:{click:function(e){t.changeSort(!1)}}},[t._v("New")])])},staticRenderFns:[]};var u=n("Z0/y")(a,c,!1,function(t){n("IMhz")},null,null).exports;function l(t){return Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&")}function d(t,e){return~t.indexOf("?")?("&"!==t[t.length-1]&&(t="&"+t),t+l(e)):t+"?"+l(e)}function h(t,e){var n=new RegExp(e+"=([^&]*)"),o=t.match(n);return o&&o.length?o[1]:""}var m=function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=new Promise(function(t,n){e.resolve=t,e.reject=n});this.then=n.then.bind(n),this.catch=n.catch.bind(n),this.promise=n},v="https://api.github.com";function f(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t=t.toUpperCase(),/^http/.test(e)||(e=v+e),o&&(e="https://cors-anywhere.herokuapp.com/"+e);var s=new m,i=new XMLHttpRequest;return i.onload=function(){s.resolve(this.responseText)},i.onerror=function(t){s.reject(t.message)},"GET"===t?(n._=Math.random(),e=d(e,n),n=null):"POST"===t&&(n=JSON.stringify(n)),i.open(t,e,!0),i.setRequestHeader("Accept","*/*,application/vnd.github.squirrel-girl-preview,application/vnd.github.html+json"),r.access_token&&i.setRequestHeader("Authorization","token "+r.access_token),"POST"===t&&i.setRequestHeader("Content-Type","application/json"),i.send(n),s.promise}var p={get:function(t,e,n){return f("get",t,e,n)},post:function(t,e,n){return f("post",t,e,n)}};var g=["vue-git-comment"],_=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}();function C(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var w=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return _(t,[{key:"config",value:function(t){r.reset(),Object.assign(r,t),this.init()}},{key:"init",value:function(){this._backStep()||this._tokenStep()||this._normalStep()}},{key:"_backStep",value:function(){var t=this,e=this._checkBack();return!!e&&(console.log("backstep"),this._getToken(e).then(function(){return t.getUserInfo(),t._getIssueInfo()}).then(function(){return t.getCurrentPage()}).catch(function(t){return console.log(t)}),!0)}},{key:"_tokenStep",value:function(){var t=this,e=localStorage.getItem("GIT_COMMENT_ACCESS_STOKEN");return!!e&&(console.log("tokenstep"),r.access_token=e,this.getUserInfo().then(function(){return t._getIssueInfo()}).then(function(){return t.getCurrentPage()}).catch(function(t){return console.log(t)}),!0)}},{key:"_normalStep",value:function(){var t=this;console.log("normalstep"),this._getIssueInfo().then(function(){return t.getCurrentPage()}).catch(function(t){return console.log(t)})}},{key:"_checkBack",value:function(){var t=window.location.search;return!!/(?=\S*code=\S*)(?=\S*state=\S*)/.test(t)&&h(window.location.search,"code")}},{key:"_getToken",value:function(t){var e=h(window.location.search,"state");return e=decodeURIComponent(e),r.userInfo.loading=!0,function(t){var e=r.client_id,n=r.client_secret;return p.post("https://github.com/login/oauth/access_token",{client_id:e,client_secret:n,code:t},!0).then(function(t){return h(t,"access_token")})}(t).then(function(t){r.access_token=t,localStorage.setItem("GIT_COMMENT_ACCESS_STOKEN",t),window.history.replaceState(null,null,e)})}},{key:"_getIssueInfo",value:function(){return(t=[r.key].concat(C(g)).join(","),e=r.owner,n=r.repo,p.get("/repos/"+e+"/"+n+"/issues",{creator:e,labels:t}).then(function(t){return JSON.parse(t)[0]})).then(function(t){if(!t)throw r.issue.created=!1,new Error("issue uninited");r.issue.created=!0,r.comments.count=t.comments,r.issue.number=t.number,r.issue.likedCount=t.reactions.heart});var t,e,n}},{key:"login",value:function(){var t,e;t=r.client_id,e=d(e="https://github.com/login/oauth/authorize",{client_id:t,redirect_uri:window.location.href,scope:"public_repo",state:window.location.href}),window.location.href=e}},{key:"logOut",value:function(){r.update({ifLogin:!1,access_token:"",userInfo:{loading:!1,name:"",avatar_url:""}}),window.localStorage.removeItem("GIT_COMMENT_ACCESS_STOKEN")}},{key:"getUserInfo",value:function(){var t=this;return p.get("/user").then(function(t){return JSON.parse(t)}).then(function(t){r.ifLogin=!0,r.userInfo={loading:!1,name:t.login,avatar_url:t.avatar_url}}).catch(function(e){console.log(e),t.logOut()})}},{key:"getCurrentPage",value:function(){return r.comments.loading=!0,(t=r.owner,e=r.repo,n=r.issue.number,p.get("/repos/"+t+"/"+e+"/issues/"+n+"/comments",{page:r.comments.page,per_page:r.comments.per_page}).then(function(t){return JSON.parse(t)})).then(function(t){t=t.map(function(t,e){return{id:t.id,body:t.body_html,created_at:function(t,e){var n={"y+":t.getFullYear(),"M+":t.getMonth()+1,"d+":t.getDate(),"H+":t.getHours(),"h+":t.getHours()-12,"m+":t.getMinutes(),"s+":t.getSeconds()},o=function(t){var o=new RegExp(t,"g");e=e.replace(o,function(e){return("000000"+n[t]).slice(-e.length)})};for(var s in n)o(s);return e}(new Date(t.created_at),"yyyy/MM/dd HH:mm:ss"),heart:t.reactions.heart,hasHeart:!1,user:{name:t.user.login,avatar_url:t.user.avatar_url,link:t.user.html_url}}}),r.comments.loading=!1,r.comments.list=t});var t,e,n}},{key:"createIssue",value:function(){return t=[r.key].concat(C(g)),e=r.title||document.title.substr(0,20),n="this issue is made for: https://github.com/shalldie/vue-git-comment",o=r.owner,s=r.repo,p.post("/repos/"+o+"/"+s+"/issues",{labels:t,title:e,body:n});var t,e,n,o,s}},{key:"createComment",value:function(t){return function(t){var e=r.owner,n=r.repo,o=r.issue.number;return p.post("/repos/"+e+"/"+n+"/issues/"+o+"/comments",{body:t})}(t)}}]),t}()),y={data:function(){return{store:r,heartIcon:i,creating:!1}},methods:{createIssue:function(){var t=this;this.creating=!0,w.createIssue().then(function(){t.creating=!1,r.issue.created=!0,w.init()})}}},k={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"comment-body"},[t.creating?n("div",[t._v("Be creating...")]):t.store.issue.created||t.store.owner!==t.store.userInfo.name?t.store.comments.loading?n("div",{staticClass:"comment-loading"},[t._v("loading ...")]):n("div",{staticClass:"comment-list"},t._l(t.store.comments.list,function(e,o){return n("div",{key:o,staticClass:"markdown-body comment-list-item"},[n("img",{staticClass:"user-avatar",attrs:{src:e.user.avatar_url}}),t._v(" "),n("div",{staticClass:"comment-item-main"},[n("div",{staticClass:"cim-header"},[n("a",{staticClass:"cim-name",attrs:{target:"_blank",href:e.user.link}},[t._v(t._s(e.user.name))]),t._v(" "),n("span",{staticClass:"cim-time"},[t._v("commented on "+t._s(e.created_at))]),t._v(" "),n("span",{staticClass:"cim-heart-icon",domProps:{innerHTML:t._s(t.heartIcon)}})]),t._v(" "),n("div",{staticClass:"cim-body",domProps:{innerHTML:t._s(e.body)}})])])})):n("div",[t._v("\n        Seems new,\n        "),n("a",{attrs:{href:"javascript:void(0)"},on:{click:t.createIssue}},[t._v("Click")]),t._v("\n        to create an issue.\n    ")])])},staticRenderFns:[]};var b={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"comment-pagination"},[this._v("\n    this is pagination.\n")])},staticRenderFns:[]};var S={data:function(){return{store:r,githubIcon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><path d="M25 10c-8.3 0-15 6.7-15 15 0 6.6 4.3 12.2 10.3 14.2.8.1 1-.3 1-.7v-2.6c-4.2.9-5.1-2-5.1-2-.7-1.7-1.7-2.2-1.7-2.2-1.4-.9.1-.9.1-.9 1.5.1 2.3 1.5 2.3 1.5 1.3 2.3 3.5 1.6 4.4 1.2.1-1 .5-1.6 1-2-3.3-.4-6.8-1.7-6.8-7.4 0-1.6.6-3 1.5-4-.2-.4-.7-1.9.1-4 0 0 1.3-.4 4.1 1.5 1.2-.3 2.5-.5 3.8-.5 1.3 0 2.6.2 3.8.5 2.9-1.9 4.1-1.5 4.1-1.5.8 2.1.3 3.6.1 4 1 1 1.5 2.4 1.5 4 0 5.8-3.5 7-6.8 7.4.5.5 1 1.4 1 2.8v4.1c0 .4.3.9 1 .7 6-2 10.2-7.6 10.2-14.2C40 16.7 33.3 10 25 10z"/></svg>',spinnerIcon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><path d="M25 18c-.6 0-1-.4-1-1V9c0-.6.4-1 1-1s1 .4 1 1v8c0 .6-.4 1-1 1z"/><path opacity=".3" d="M25 42c-.6 0-1-.4-1-1v-8c0-.6.4-1 1-1s1 .4 1 1v8c0 .6-.4 1-1 1z"/><path opacity=".3" d="M29 19c-.2 0-.3 0-.5-.1-.4-.3-.6-.8-.3-1.3l4-6.9c.3-.4.8-.6 1.3-.3.4.3.6.8.3 1.3l-4 6.9c-.2.2-.5.4-.8.4z"/><path opacity=".3" d="M17 39.8c-.2 0-.3 0-.5-.1-.4-.3-.6-.8-.3-1.3l4-6.9c.3-.4.8-.6 1.3-.3.4.3.6.8.3 1.3l-4 6.9c-.2.2-.5.4-.8.4z"/><path opacity=".93" d="M21 19c-.3 0-.6-.2-.8-.5l-4-6.9c-.3-.4-.1-1 .3-1.3.4-.3 1-.1 1.3.3l4 6.9c.3.4.1 1-.3 1.3-.2.2-.3.2-.5.2z"/><path opacity=".3" d="M33 39.8c-.3 0-.6-.2-.8-.5l-4-6.9c-.3-.4-.1-1 .3-1.3.4-.3 1-.1 1.3.3l4 6.9c.3.4.1 1-.3 1.3-.2.1-.3.2-.5.2z"/><path opacity=".65" d="M17 26H9c-.6 0-1-.4-1-1s.4-1 1-1h8c.6 0 1 .4 1 1s-.4 1-1 1z"/><path opacity=".3" d="M41 26h-8c-.6 0-1-.4-1-1s.4-1 1-1h8c.6 0 1 .4 1 1s-.4 1-1 1z"/><path opacity=".86" d="M18.1 21.9c-.2 0-.3 0-.5-.1l-6.9-4c-.4-.3-.6-.8-.3-1.3.3-.4.8-.6 1.3-.3l6.9 4c.4.3.6.8.3 1.3-.2.3-.5.4-.8.4z"/><path opacity=".3" d="M38.9 33.9c-.2 0-.3 0-.5-.1l-6.9-4c-.4-.3-.6-.8-.3-1.3.3-.4.8-.6 1.3-.3l6.9 4c.4.3.6.8.3 1.3-.2.3-.5.4-.8.4z"/><path opacity=".44" d="M11.1 33.9c-.3 0-.6-.2-.8-.5-.3-.4-.1-1 .3-1.3l6.9-4c.4-.3 1-.1 1.3.3.3.4.1 1-.3 1.3l-6.9 4c-.1.2-.3.2-.5.2z"/><path opacity=".3" d="M31.9 21.9c-.3 0-.6-.2-.8-.5-.3-.4-.1-1 .3-1.3l6.9-4c.4-.3 1-.1 1.3.3.3.4.1 1-.3 1.3l-6.9 4c-.2.2-.3.2-.5.2z"/></svg>',showArea:!0,submitting:!1,areaContent:"",markdownContent:"Nothing to preview",cacheList:[]}},methods:{getCache:function(t){for(var e=0,n=this.cacheList.length;e<n;e++){var o=this.cacheList[e];if(o.content===t)return o.preview}},addCache:function(t,e){this.cacheList.push({content:t,preview:e}),this.cacheList.length>10&&this.cacheList.shift()},login:function(){w.login()},logOut:function(){w.logOut()},comment:function(){var t=this;this.submitting=!0,w.createComment(this.areaContent).then(function(){return t.areaContent="",t.submitting=!1,t.showArea=!0,w.getCurrentPage()})}},watch:{showArea:function(t){var e=this;if(this.areaContent=this.areaContent.trim(),!t&&this.areaContent.length){var n,o=this.getCache(this.areaContent);if(o)this.markdownContent=o;else this.markdownContent="Loading preview ...",(n=this.areaContent,p.post("/markdown",{mode:"gfm",text:n})).then(function(t){t=t.replace(/(<a )/g,'$1target="_blank" '),e.markdownContent=t,e.addCache(e.areaContent,t)})}else this.markdownContent="Nothing to preview"}}},I={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"comment-editor"},[t.store.ifLogin||t.store.userInfo.loading?!t.store.ifLogin&&t.store.userInfo.loading?n("span",{staticClass:"user-avatar user-avatar-loading",domProps:{innerHTML:t._s(t.spinnerIcon)}}):n("img",{staticClass:"user-avatar user-avatar-img",attrs:{src:t.store.userInfo.avatar_url}}):n("span",{staticClass:"user-avatar",attrs:{href:"javascript:void(0)"},domProps:{innerHTML:t._s(t.githubIcon)}}),t._v(" "),n("div",{staticClass:"comment-editor-main"},[n("div",{staticClass:"ce-header has-border"},[n("div",{staticClass:"ce-tab-item",class:{active:t.showArea},on:{click:function(e){t.showArea=!0}}},[t._v("Write")]),t._v(" "),n("div",{staticClass:"ce-tab-item",class:{active:!t.showArea},on:{click:function(e){t.showArea=!1}}},[t._v("Preview")]),t._v(" "),t.store.ifLogin?n("span",{staticClass:"logout-link",on:{click:t.logOut}},[t._v("Logout")]):n("div",{staticClass:"login-link-btn"},[n("a",{attrs:{href:"javascript:void(0)"},on:{click:t.login}},[t._v("Login")]),t._v("\n                with Github\n            ")])]),t._v(" "),n("div",{staticClass:"ce-body"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.areaContent,expression:"areaContent"},{name:"show",rawName:"v-show",value:t.showArea,expression:"showArea"}],staticClass:"ce-textarea",attrs:{disabled:!t.store.ifLogin||t.submitting,placeholder:"Leave a comment."},domProps:{value:t.areaContent},on:{input:function(e){e.target.composing||(t.areaContent=e.target.value)}}}),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.showArea,expression:"!showArea"}],staticClass:"markdown-body ce-preview",domProps:{innerHTML:t._s(t.markdownContent)}})]),t._v(" "),n("div",{staticClass:"ce-commit-row"},[n("a",{staticClass:"ce-md-link",attrs:{target:"_blank",href:"https://guides.github.com/features/mastering-markdown/"}},[t._v("Styling with Markdown is supported")]),t._v(" "),n("button",{staticClass:"ce-commit-btn",attrs:{disabled:!t.store.ifLogin||t.submitting},on:{click:t.comment}},[t._v(t._s(t.submitting?"Submitting ...":"Comment"))])]),t._v(" "),t._m(0)])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"ce-power-row"},[this._v("\n            Powered by\n            "),e("a",{attrs:{target:"_blank",href:"https://github.com/shalldie/vue-git-comment"}},[this._v("vue-git-comment")])])}]};var M={props:{options:{required:!0}},components:{CommentHeader:u,CommentBody:n("Z0/y")(y,k,!1,function(t){n("ZyKx")},null,null).exports,CommentPagination:n("Z0/y")({},b,!1,function(t){n("fx5E")},null,null).exports,CommentEditor:n("Z0/y")(S,I,!1,function(t){n("Fa5i")},null,null).exports},mounted:function(){w.config(this.options)}},x={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"vue-git-comment"},[e("CommentHeader"),this._v(" "),e("CommentBody"),this._v(" "),e("CommentPagination"),this._v(" "),e("CommentEditor")],1)},staticRenderFns:[]};var O=n("Z0/y")(M,x,!1,function(t){n("LNnq")},null,null).exports;O.install=function(t){t.component("vue-git-comment",O)};e.default=O},"Z0/y":function(t,e){t.exports=function(t,e,n,o,s,r){var i,a=t=t||{},c=typeof t.default;"object"!==c&&"function"!==c||(i=t,a=t.default);var u,l="function"==typeof a?a.options:a;if(e&&(l.render=e.render,l.staticRenderFns=e.staticRenderFns,l._compiled=!0),n&&(l.functional=!0),s&&(l._scopeId=s),r?(u=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),o&&o.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(r)},l._ssrRegister=u):o&&(u=o),u){var d=l.functional,h=d?l.render:l.beforeCreate;d?(l._injectStyles=u,l.render=function(t,e){return u.call(e),h(t,e)}):l.beforeCreate=h?[].concat(h,u):[u]}return{esModule:i,exports:a,options:l}}},ZyKx:function(t,e){},fx5E:function(t,e){}}).default});